{{/* Analytics and Cookie Consent - Klaro + Google Analytics */}}
{{ with .Site.Params.googleAnalyticsID }}
{{/* Only load analytics if a Google Analytics ID is configured */}}

{{/* Klaro Configuration - must load before klaro.js */}}
{{ $klaroConfig := resources.Get "js/klaro-config.js" }}
{{ if hugo.IsProduction }}
  {{ $klaroConfig = $klaroConfig | minify | fingerprint }}
{{ end }}
<script src="{{ $klaroConfig.RelPermalink }}"></script>

{{/* Klaro Script - self-hosted and renamed to avoid ad blocker filter lists.
     Using no-css variant so the JS doesn't inject its own <style> tag,
     allowing our _klaro.scss overrides to take effect */}}
{{ $klaroJs := resources.Get "js/consent-manager.js" }}
{{ if hugo.IsProduction }}
  {{ $klaroJs = $klaroJs | minify | fingerprint }}
{{ end }}
<script src="{{ $klaroJs.RelPermalink }}"></script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}">
</script>
<script>
     window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '{{ . }}');
</script>{{ end }}